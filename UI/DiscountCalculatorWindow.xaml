<ui:FluentWindow
    x:Class="Automatization.UI.DiscountCalculatorWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Automatization.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Automatization.UI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="Discount Calculator"
    Width="1000"
    Height="850"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <BitmapImage
            x:Key="CrystalIcon"
            CacheOption="OnLoad"
            UriSource="https://wiki.pro-tanki.com/en/images/8/80/Crysmini.png" />
        <converters:UriToBitmapConverter x:Key="UriToBitmapConverter" />
        <converters:IntToColorConverter x:Key="IntToColorConverter" />
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter" />
        <converters:CategoryToVisibilityConverter x:Key="CategoryToVisibilityConverter" />
        <converters:IntEmptyToOneConverter x:Key="IntEmptyToOneConverter" />
        <converters:DoubleEmptyToZeroConverter x:Key="DoubleEmptyToZeroConverter" />

        <Style x:Key="TransparentListBoxItem" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <ContentPresenter />
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <ItemsPanelTemplate x:Key="MarketItemsPanelTemplate">
            <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal" />
        </ItemsPanelTemplate>

        <DataTemplate x:Key="SimpleItemTemplate">
            <Border
                x:Name="CardBorder"
                Width="110"
                Height="130"
                Margin="3"
                Padding="5"
                Background="#20FFFFFF"
                BorderBrush="Transparent"
                BorderThickness="2"
                CornerRadius="5">
                <StackPanel VerticalAlignment="Center">
                    <Image
                        Width="80"
                        Height="80"
                        Margin="0,0,0,5"
                        RenderOptions.BitmapScalingMode="Fant"
                        Source="{Binding ImageUrl, Converter={StaticResource UriToBitmapConverter}, IsAsync=True}" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        FontSize="12"
                        FontWeight="SemiBold"
                        Text="{Binding LocalizedName}"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                </StackPanel>
            </Border>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                    <Setter TargetName="CardBorder" Property="BorderBrush" Value="#FF60CDFF" />
                    <Setter TargetName="CardBorder" Property="Background" Value="#40FFFFFF" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBoxItem}, Path=IsMouseOver}" Value="True">
                    <Setter TargetName="CardBorder" Property="Background" Value="#30FFFFFF" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <DataTemplate x:Key="PricedItemTemplate">
            <Border
                x:Name="CardBorder"
                Width="110"
                Height="145"
                Margin="3"
                Padding="5"
                Background="#20FFFFFF"
                BorderBrush="Transparent"
                BorderThickness="2"
                CornerRadius="5">
                <StackPanel VerticalAlignment="Center">
                    <Image
                        Width="80"
                        Height="80"
                        Margin="0,0,0,5"
                        RenderOptions.BitmapScalingMode="Fant"
                        Source="{Binding ImageUrl, Converter={StaticResource UriToBitmapConverter}, IsAsync=True}" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        FontSize="12"
                        FontWeight="SemiBold"
                        Text="{Binding LocalizedName}"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                    <StackPanel
                        Margin="0,2,0,0"
                        HorizontalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            FontSize="11"
                            Foreground="Gray"
                            Text="{Binding Prices[0], StringFormat='{}{0:N0}'}" />
                        <Image
                            Width="10"
                            Height="10"
                            Margin="2,0,0,0"
                            RenderOptions.BitmapScalingMode="Fant"
                            Source="{StaticResource CrystalIcon}" />
                    </StackPanel>
                </StackPanel>
            </Border>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBoxItem}, Path=IsSelected}" Value="True">
                    <Setter TargetName="CardBorder" Property="BorderBrush" Value="#FF60CDFF" />
                    <Setter TargetName="CardBorder" Property="Background" Value="#40FFFFFF" />
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ListBoxItem}, Path=IsMouseOver}" Value="True">
                    <Setter TargetName="CardBorder" Property="Background" Value="#30FFFFFF" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.7*" MinWidth="350" />
            <ColumnDefinition Width="1.2*" MinWidth="300" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ui:TitleBar
            Title="{DynamicResource Discount_Title}"
            Grid.Row="0"
            Grid.ColumnSpan="2" />

        <Grid
            Grid.Row="1"
            Grid.Column="0"
            Margin="0,0,5,20">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,10,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <ui:TextBox
                    Grid.Column="0"
                    Margin="10,0,10,0"
                    Icon="{ui:SymbolIcon Symbol=Search24}"
                    PlaceholderText="{DynamicResource Discount_Search}"
                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                <ComboBox
                    Grid.Column="1"
                    Width="160"
                    SelectedIndex="{Binding SelectedSortIndex}">
                    <ComboBoxItem Content="{DynamicResource Discount_Sort_NameAZ}" />
                    <ComboBoxItem Content="{DynamicResource Discount_Sort_NameZA}" />
                    <ComboBoxItem Content="{DynamicResource Discount_Sort_PriceLowHigh}" />
                    <ComboBoxItem Content="{DynamicResource Discount_Sort_PriceHighLow}" />
                </ComboBox>
            </Grid>

            <ScrollViewer
                Grid.Row="1"
                Padding="10,0,10,0"
                VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <Expander
                        x:Name="TurretsExpander"
                        Margin="0,0,0,5"
                        Expanded="Expander_Expanded"
                        Header="{DynamicResource Discount_Turrets}"
                        IsExpanded="True">
                        <ListBox
                            x:Name="TurretsListBox"
                            MaxHeight="350"
                            HorizontalContentAlignment="Center"
                            ItemContainerStyle="{StaticResource TransparentListBoxItem}"
                            ItemTemplate="{StaticResource SimpleItemTemplate}"
                            ItemsPanel="{StaticResource MarketItemsPanelTemplate}"
                            ItemsSource="{Binding TurretsView}"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            SelectionChanged="ItemListBox_SelectionChanged"
                            VirtualizingPanel.ScrollUnit="Pixel"
                            VirtualizingPanel.VirtualizationMode="Recycling" />
                    </Expander>

                    <Expander
                        x:Name="HullsExpander"
                        Margin="0,5"
                        Expanded="Expander_Expanded"
                        Header="{DynamicResource Discount_Hulls}"
                        IsExpanded="False">
                        <ListBox
                            x:Name="HullsListBox"
                            MaxHeight="500"
                            HorizontalContentAlignment="Center"
                            ItemContainerStyle="{StaticResource TransparentListBoxItem}"
                            ItemTemplate="{StaticResource SimpleItemTemplate}"
                            ItemsPanel="{StaticResource MarketItemsPanelTemplate}"
                            ItemsSource="{Binding HullsView}"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            SelectionChanged="ItemListBox_SelectionChanged"
                            VirtualizingPanel.ScrollUnit="Pixel"
                            VirtualizingPanel.VirtualizationMode="Recycling" />
                    </Expander>

                    <Expander
                        x:Name="PaintsExpander"
                        Margin="0,5"
                        Expanded="Expander_Expanded"
                        Header="{DynamicResource Discount_Paints}"
                        IsExpanded="False">
                        <ListBox
                            x:Name="PaintsListBox"
                            MaxHeight="600"
                            HorizontalContentAlignment="Center"
                            ItemContainerStyle="{StaticResource TransparentListBoxItem}"
                            ItemTemplate="{StaticResource PricedItemTemplate}"
                            ItemsPanel="{StaticResource MarketItemsPanelTemplate}"
                            ItemsSource="{Binding PaintsView}"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            SelectionChanged="ItemListBox_SelectionChanged"
                            VirtualizingPanel.ScrollUnit="Pixel"
                            VirtualizingPanel.VirtualizationMode="Recycling" />
                    </Expander>

                    <Expander
                        x:Name="SuppliesExpander"
                        Margin="0,5"
                        Expanded="Expander_Expanded"
                        Header="{DynamicResource Discount_Supplies}"
                        IsExpanded="False">
                        <ListBox
                            x:Name="SuppliesListBox"
                            MaxHeight="450"
                            HorizontalContentAlignment="Center"
                            ItemContainerStyle="{StaticResource TransparentListBoxItem}"
                            ItemTemplate="{StaticResource PricedItemTemplate}"
                            ItemsPanel="{StaticResource MarketItemsPanelTemplate}"
                            ItemsSource="{Binding SuppliesView}"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            SelectionChanged="ItemListBox_SelectionChanged"
                            VirtualizingPanel.ScrollUnit="Pixel"
                            VirtualizingPanel.VirtualizationMode="Recycling" />
                    </Expander>

                    <Expander
                        x:Name="ProductKitsExpander"
                        Margin="0,5"
                        Expanded="Expander_Expanded"
                        Header="{DynamicResource Discount_ProductKits}"
                        IsExpanded="False">
                        <ListBox
                            x:Name="ProductKitsListBox"
                            MaxHeight="500"
                            HorizontalContentAlignment="Center"
                            ItemContainerStyle="{StaticResource TransparentListBoxItem}"
                            ItemTemplate="{StaticResource PricedItemTemplate}"
                            ItemsPanel="{StaticResource MarketItemsPanelTemplate}"
                            ItemsSource="{Binding ProductKitsView}"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            SelectionChanged="ItemListBox_SelectionChanged"
                            VirtualizingPanel.ScrollUnit="Pixel"
                            VirtualizingPanel.VirtualizationMode="Recycling" />
                    </Expander>

                    <Expander
                        x:Name="SuppliesKitsExpander"
                        Margin="0,5"
                        Expanded="Expander_Expanded"
                        Header="{DynamicResource Discount_SuppliesKits}"
                        IsExpanded="False">
                        <ListBox
                            x:Name="SuppliesKitsListBox"
                            MaxHeight="500"
                            HorizontalContentAlignment="Center"
                            ItemContainerStyle="{StaticResource TransparentListBoxItem}"
                            ItemTemplate="{StaticResource PricedItemTemplate}"
                            ItemsPanel="{StaticResource MarketItemsPanelTemplate}"
                            ItemsSource="{Binding SuppliesKitsView}"
                            ScrollViewer.CanContentScroll="True"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            SelectionChanged="ItemListBox_SelectionChanged"
                            VirtualizingPanel.ScrollUnit="Pixel"
                            VirtualizingPanel.VirtualizationMode="Recycling" />
                    </Expander>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <Border
            Grid.Row="1"
            Grid.Column="1"
            Margin="5,0,10,10"
            Background="#10FFFFFF"
            CornerRadius="8">
            <ScrollViewer Focusable="False" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10">
                    <Grid Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            FontSize="18"
                            FontWeight="Bold"
                            Text="{DynamicResource Discount_Details}" />
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <ToggleButton
                                x:Name="CumulativeToggle"
                                Margin="0,0,10,0"
                                Checked="CumulativeToggle_CheckedChanged"
                                Content="{DynamicResource Discount_Cumulative}"
                                Unchecked="CumulativeToggle_CheckedChanged" />
                            <ToggleButton
                                x:Name="CompareToggle"
                                Checked="CompareToggle_Checked"
                                Content="{DynamicResource Discount_CompareMode}"
                                Unchecked="CompareToggle_Unchecked" />
                        </StackPanel>
                    </Grid>

                    <Grid x:Name="SingleItemPanel" Margin="0,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="SelectedImage"
                            Width="80"
                            Height="80"
                            Margin="0,0,15,0"
                            VerticalAlignment="Top"
                            RenderOptions.BitmapScalingMode="HighQuality" />
                        <StackPanel Grid.Column="1">
                            <TextBlock
                                x:Name="SelectedItemText"
                                Margin="0,0,0,5"
                                FontSize="20"
                                FontWeight="Bold"
                                Text="{DynamicResource Discount_SelectItem}" />
                            <TextBlock
                                x:Name="SelectedDescriptionText"
                                Margin="0,0,0,10"
                                FontStyle="Italic"
                                Foreground="Gray"
                                TextWrapping="Wrap" />

                            <ItemsControl x:Name="StatsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                VerticalAlignment="Top"
                                                FontWeight="SemiBold"
                                                Foreground="#AAFFFFFF"
                                                Text="{Binding Key}" />

                                            <ContentControl
                                                x:Name="ValueContent"
                                                Grid.Column="1"
                                                HorizontalAlignment="Stretch">
                                                <TextBlock
                                                    HorizontalAlignment="Right"
                                                    Text="{Binding Value}"
                                                    TextAlignment="Right"
                                                    TextWrapping="Wrap" />
                                            </ContentControl>
                                        </Grid>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding IsRank}" Value="True">
                                                <Setter TargetName="ValueContent" Property="Content">
                                                    <Setter.Value>
                                                        <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                                            <Image
                                                                Width="20"
                                                                Height="20"
                                                                RenderOptions.BitmapScalingMode="HighQuality"
                                                                Source="{Binding RankStartIcon, Converter={StaticResource UriToBitmapConverter}, IsAsync=True}" />
                                                            <TextBlock
                                                                Margin="5,0"
                                                                VerticalAlignment="Center"
                                                                Text="-" />
                                                            <Image
                                                                Width="20"
                                                                Height="20"
                                                                RenderOptions.BitmapScalingMode="HighQuality"
                                                                Source="{Binding RankEndIcon, Converter={StaticResource UriToBitmapConverter}, IsAsync=True}" />
                                                        </StackPanel>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <StackPanel
                                Margin="0,10,0,0"
                                Orientation="Horizontal"
                                Visibility="{Binding IsSupplyItemSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock
                                    Margin="0,0,5,0"
                                    VerticalAlignment="Center"
                                    Text="{DynamicResource Discount_Quantity}" />
                                <ui:TextBox
                                    Width="100"
                                    PreviewTextInput="QuantityTextBox_PreviewTextInput"
                                    Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource IntEmptyToOneConverter}}" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>

                    <Grid
                        x:Name="ComparisonHeaderPanel"
                        Margin="0,0,0,15"
                        Visibility="Collapsed">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Top">
                            <Image
                                x:Name="CompareImageA"
                                Width="60"
                                Height="60"
                                Margin="0,0,0,5"
                                RenderOptions.BitmapScalingMode="HighQuality" />
                            <TextBlock
                                x:Name="CompareNameA"
                                HorizontalAlignment="Center"
                                FontWeight="Bold"
                                Text="Item A"
                                TextWrapping="Wrap" />
                        </StackPanel>

                        <TextBlock
                            Grid.Column="1"
                            Margin="15,20"
                            FontSize="16"
                            FontWeight="Bold"
                            Foreground="Gray"
                            Text="{DynamicResource Discount_VS}" />

                        <StackPanel
                            Grid.Column="2"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Top">
                            <Image
                                x:Name="CompareImageB"
                                Width="60"
                                Height="60"
                                Margin="0,0,0,5"
                                RenderOptions.BitmapScalingMode="HighQuality" />
                            <TextBlock
                                x:Name="CompareNameB"
                                HorizontalAlignment="Center"
                                FontWeight="Bold"
                                Text="{DynamicResource Discount_SelectItemB}"
                                TextWrapping="Wrap" />
                        </StackPanel>
                    </Grid>

                    <Separator Margin="0,0,0,15" Background="#20FFFFFF" />

                    <GroupBox Margin="0,0,0,15" Header="{DynamicResource Discount_Percentage}">
                        <StackPanel Margin="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Slider
                                    x:Name="DiscountSlider"
                                    Maximum="100"
                                    Minimum="0"
                                    TickFrequency="1"
                                    Value="{Binding DiscountValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <TextBox
                                    Grid.Column="1"
                                    Width="60"
                                    Margin="10,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="{Binding DiscountValue, StringFormat={}{0:F0}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DoubleEmptyToZeroConverter}}" />
                                <TextBlock
                                    Grid.Column="2"
                                    Margin="2,0,0,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    FontWeight="Bold"
                                    Text="%" />
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <ItemsControl
                        x:Name="ResultsList"
                        Margin="0,0,0,15"
                        Visibility="Visible">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,0,8"
                                    Padding="12"
                                    Background="#15FFFFFF"
                                    BorderBrush="#20FFFFFF"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel VerticalAlignment="Center">
                                            <Border
                                                Width="40"
                                                Height="40"
                                                Margin="0,0,0,4"
                                                Background="#30000000"
                                                CornerRadius="20">
                                                <ui:SymbolIcon
                                                    FontSize="20"
                                                    Foreground="CornflowerBlue"
                                                    Symbol="SlideSize24" />
                                            </Border>
                                            <TextBlock
                                                HorizontalAlignment="Center"
                                                FontSize="11"
                                                FontWeight="Bold"
                                                Foreground="CornflowerBlue"
                                                Text="{Binding Modification}"
                                                TextAlignment="Center"
                                                TextWrapping="Wrap" />
                                        </StackPanel>

                                        <StackPanel
                                            Grid.Column="1"
                                            Margin="15,0,0,0"
                                            VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal" Visibility="{Binding DiscountAmount, Converter={StaticResource IntToVisibilityConverter}}">
                                                <TextBlock
                                                    FontSize="12"
                                                    Foreground="Gray"
                                                    Text="{Binding BasePrice, StringFormat={}{0:N0}}"
                                                    TextDecorations="Strikethrough" />
                                            </StackPanel>

                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock
                                                    FontSize="18"
                                                    FontWeight="Bold"
                                                    Text="{Binding FinalPrice, StringFormat={}{0:N0}}" />
                                                <Image
                                                    Width="14"
                                                    Height="14"
                                                    Margin="4,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Source="{StaticResource CrystalIcon}" />
                                            </StackPanel>
                                        </StackPanel>

                                        <Border
                                            Grid.Column="2"
                                            Padding="8,4"
                                            Background="#2000FF00"
                                            CornerRadius="4"
                                            Visibility="{Binding DiscountAmount, Converter={StaticResource IntToVisibilityConverter}}">
                                            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                                                <TextBlock
                                                    Margin="0,0,5,0"
                                                    FontWeight="SemiBold"
                                                    Foreground="LightGreen"
                                                    Text="{DynamicResource Discount_Save}" />
                                                <TextBlock
                                                    FontWeight="Bold"
                                                    Foreground="LightGreen"
                                                    Text="{Binding DiscountAmount, StringFormat={}{0:N0}}" />
                                                <Image
                                                    Width="12"
                                                    Height="12"
                                                    Margin="3,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Source="{StaticResource CrystalIcon}" />
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Grid
                        x:Name="ComparisonContainer"
                        Margin="0,0,0,15"
                        Visibility="Collapsed">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="15" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <ItemsControl x:Name="ComparisonListA" Grid.Column="0">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,0,0,8"
                                        Padding="10"
                                        Background="#15FFFFFF"
                                        BorderBrush="#20FFFFFF"
                                        BorderThickness="1"
                                        CornerRadius="8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel VerticalAlignment="Center">
                                                <Border
                                                    Width="30"
                                                    Height="30"
                                                    Margin="0,0,0,2"
                                                    Background="#30000000"
                                                    CornerRadius="15">
                                                    <ui:SymbolIcon
                                                        FontSize="16"
                                                        Foreground="CornflowerBlue"
                                                        Symbol="SlideSize24" />
                                                </Border>
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="10"
                                                    FontWeight="Bold"
                                                    Foreground="CornflowerBlue"
                                                    Text="{Binding Modification}"
                                                    TextAlignment="Center"
                                                    TextWrapping="Wrap" />
                                            </StackPanel>
                                            <StackPanel
                                                Grid.Column="1"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Orientation="Horizontal">
                                                <TextBlock
                                                    FontSize="14"
                                                    FontWeight="Bold"
                                                    Text="{Binding PriceA, StringFormat={}{0:N0}}" />
                                                <Image
                                                    Width="12"
                                                    Height="12"
                                                    Margin="3,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Source="{StaticResource CrystalIcon}" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <ItemsControl x:Name="ComparisonListB" Grid.Column="2">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,0,0,8"
                                        Padding="10"
                                        Background="#15FFFFFF"
                                        BorderBrush="#20FFFFFF"
                                        BorderThickness="1"
                                        CornerRadius="8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel VerticalAlignment="Center">
                                                <Border
                                                    Width="30"
                                                    Height="30"
                                                    Margin="0,0,0,2"
                                                    Background="#30000000"
                                                    CornerRadius="15">
                                                    <ui:SymbolIcon
                                                        FontSize="16"
                                                        Foreground="CornflowerBlue"
                                                        Symbol="SlideSize24" />
                                                </Border>
                                                <TextBlock
                                                    HorizontalAlignment="Center"
                                                    FontSize="10"
                                                    FontWeight="Bold"
                                                    Foreground="CornflowerBlue"
                                                    Text="{Binding Modification}"
                                                    TextAlignment="Center"
                                                    TextWrapping="Wrap" />
                                            </StackPanel>
                                            <StackPanel
                                                Grid.Column="1"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Orientation="Horizontal">
                                                <TextBlock
                                                    FontSize="14"
                                                    FontWeight="Bold"
                                                    Foreground="{Binding Difference, Converter={StaticResource IntToColorConverter}}"
                                                    Text="{Binding PriceB, StringFormat={}{0:N0}}" />
                                                <Image
                                                    Width="12"
                                                    Height="12"
                                                    Margin="3,0,0,0"
                                                    VerticalAlignment="Center"
                                                    Source="{StaticResource CrystalIcon}" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>

                    <StackPanel Orientation="Vertical">
                        <Separator Margin="0,5" />
                        <DockPanel>
                            <TextBlock
                                VerticalAlignment="Center"
                                FontWeight="SemiBold"
                                Text="{DynamicResource Discount_TotalCost}" />
                            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                <TextBlock
                                    x:Name="TotalCostText"
                                    FontSize="18"
                                    FontWeight="Bold"
                                    Foreground="CornflowerBlue"
                                    Text="0" />
                                <Image
                                    Width="16"
                                    Height="16"
                                    Margin="4,0,0,0"
                                    VerticalAlignment="Center"
                                    Source="{StaticResource CrystalIcon}" />
                            </StackPanel>
                        </DockPanel>
                        <DockPanel Margin="0,5,0,0">
                            <TextBlock
                                VerticalAlignment="Center"
                                FontWeight="SemiBold"
                                Text="{DynamicResource Discount_TotalSaved}" />
                            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                <TextBlock
                                    x:Name="TotalSavedText"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Foreground="Green"
                                    Text="0" />
                                <Image
                                    Width="12"
                                    Height="12"
                                    Margin="3,0,0,0"
                                    VerticalAlignment="Center"
                                    Source="{StaticResource CrystalIcon}" />
                            </StackPanel>
                        </DockPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</ui:FluentWindow>