<ui:FluentWindow
    x:Class="Automatization.UI.ReportIssueWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Automatization.UI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="Report Issue / Idea"
    Width="400"
    Height="650"
    ExtendsContentIntoTitleBar="True"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">
    <Window.Resources>
        <Style x:Key="CharacterCounterStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource TextFillColorSecondaryBrush}" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsDescriptionOverLimit}" Value="True">
                    <Setter Property="Foreground" Value="Red" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ui:TitleBar Title="{DynamicResource Settings_ReportIssue}" Grid.Row="0" />

        <TextBlock
            Grid.Row="1"
            Margin="10,10,10,5"
            Text="Title:" />
        <TextBox
            Grid.Row="2"
            Margin="10,0,10,10"
            MaxLength="100"
            Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock
            Grid.Row="3"
            Margin="10,0,10,5"
            Text="Description:" />
        <ScrollViewer
            Grid.Row="4"
            Margin="10,0,10,5"
            VerticalScrollBarVisibility="Auto">
            <TextBox
                AcceptsReturn="True"
                Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                TextWrapping="Wrap" />
        </ScrollViewer>
        <TextBlock
            Grid.Row="5"
            Margin="10,0,10,10"
            HorizontalAlignment="Right"
            Style="{StaticResource CharacterCounterStyle}"
            Text="{Binding DescriptionCounterText}" />

        <StackPanel
            Grid.Row="6"
            Margin="10,0,10,5"
            Orientation="Horizontal">
            <ui:Button
                Margin="0,0,10,0"
                Command="{Binding AddScreenshotCommand}"
                Content="Add Screenshots (Max 4)"
                Icon="{ui:SymbolIcon ImageAdd24}" />
            <ui:Button
                Command="{Binding PasteScreenshotCommand}"
                Content="Paste Screenshot"
                Icon="{ui:SymbolIcon ClipboardPaste24}"
                ToolTip="Paste image from clipboard" />
        </StackPanel>

        <ItemsControl
            Grid.Row="7"
            Margin="10,0,10,10"
            ItemsSource="{Binding Screenshots}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="0,2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="{Binding}"
                            TextTrimming="CharacterEllipsis"
                            ToolTip="{Binding}" />
                        <ui:Button
                            Grid.Column="1"
                            Margin="5,0,0,0"
                            Padding="5"
                            Appearance="Secondary"
                            Command="{Binding DataContext.RemoveScreenshotCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                            CommandParameter="{Binding}"
                            Icon="{ui:SymbolIcon Delete24}"
                            ToolTip="Remove Screenshot" />
                    </Grid>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <CheckBox
            Grid.Row="8"
            Margin="0,0,10,10"
            Content="Include current log file"
            IsChecked="{Binding IncludeLogFile}" />

        <StackPanel
            Grid.Row="9"
            Margin="10,0,10,10"
            Orientation="Horizontal">
            <RadioButton
                Margin="0,0,10,0"
                Content="Issue"
                IsChecked="{Binding IsIdea, Converter={StaticResource InverseBooleanConverter}}" />
            <RadioButton
                Content="Idea"
                IsChecked="{Binding IsIdea}" />
        </StackPanel>

        <StackPanel
            Grid.Row="10"
            Margin="10"
            HorizontalAlignment="Right"
            Orientation="Horizontal">
            <Button
                Width="80"
                Margin="0,0,10,0"
                Command="{Binding SubmitCommand}"
                Content="Submit" />
            <Button
                Width="80"
                Command="{Binding CancelCommand}"
                Content="Cancel" />
        </StackPanel>
    </Grid>
</ui:FluentWindow>